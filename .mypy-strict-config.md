# MyPy Conservative/Strict Configuration

## Overview

This document describes the conservative MyPy type checking configuration enabled in `pyproject.toml`. The configuration is designed to enforce maximum type safety and catch type-related issues early.

## Configuration File

All MyPy settings are in `[tool.mypy]` section of `pyproject.toml`.

## Enabled Strict Options

### Core Strict Mode

- **`strict = true`**: Enables all strict type checking options

### Type Completeness

- **`disallow_untyped_defs = true`**: All functions must have complete type hints
- **`disallow_incomplete_defs = true`**: No partial type hints allowed
- **`disallow_untyped_calls = true`**: Cannot call functions without type hints
- **`disallow_untyped_decorators = true`**: Decorators must be typed
- **`check_untyped_defs = true`**: Type check even untyped function bodies

### Any Type Restrictions

- **`disallow_any_unimported = true`**: No `Any` from unimported modules
- **`disallow_any_decorated = true`**: No `Any` in decorated functions
- **`disallow_any_generics = true`**: Generics must have type parameters (e.g., `list[str]` not `list`)
- **`disallow_subclassing_any = true`**: Cannot subclass `Any`
- **`warn_return_any = true`**: Warn when returning `Any` from typed functions

### Optional Value Handling

- **`no_implicit_optional = true`**: Must use explicit `| None`, not implicit `Optional`
- **`strict_optional = true`**: Strict checking of `Optional` types

### Warning Options (All Enabled)

- **`warn_redundant_casts = true`**: Catch unnecessary type casts
- **`warn_unused_ignores = true`**: Catch unnecessary `# type: ignore` comments
- **`warn_no_return = true`**: Catch missing return statements
- **`warn_unreachable = true`**: Catch unreachable code
- **`warn_unused_configs = true`**: Catch unused MyPy settings

### Equality and Concatenation

- **`strict_equality = true`**: No comparisons between incompatible types
- **`strict_concatenate = true`**: Strict ParamSpec checking

### Module Handling

- **`implicit_reexport = false`**: Require explicit re-exports
- **`no_implicit_reexport = true`**: Need explicit `__all__` or re-exports

### Error Display

- **`show_error_codes = true`**: Show error codes like `[arg-type]`
- **`show_column_numbers = true`**: Show exact column in errors
- **`show_error_context = true`**: Show source code context
- **`pretty = true`**: Pretty formatting
- **`color_output = true`**: Colored output
- **`error_summary = true`**: Summary at end

## Module-Specific Overrides

### External Libraries (PySide6, tomli_w, ruamel)

```toml
[[tool.mypy.overrides]]
module = ["PySide6.*", "tomli_w", "ruamel.*"]
ignore_missing_imports = true
disallow_any_unimported = false
disallow_untyped_calls = false
```

**Reason**: These libraries lack complete type stubs

### Test Files

```toml
[[tool.mypy.overrides]]
module = ["DFBU.tests.*", "tests.*"]
disallow_untyped_defs = false
```

**Reason**: Test fixtures create complex signatures; still enforces other checks

## Running MyPy

### Check All Files

```bash
mypy DFBU/
```

### Check Specific File

```bash
mypy DFBU/gui/model.py
```

### With Explicit Config

```bash
mypy --config-file pyproject.toml DFBU/
```

## Common Errors You'll See

### 1. Missing Type Hints

```
error: Function is missing a type annotation  [no-untyped-def]
```

**Fix**: Add type hints to all parameters and return value

### 2. Generic Without Type Parameter

```
error: Missing type parameters for generic type "list"  [type-arg]
```

**Fix**: Use `list[str]` instead of `list`

### 3. Redundant Cast

```
error: Redundant cast to "bool"  [redundant-cast]
```

**Fix**: Remove the `cast()` - type is already correct

### 4. Incompatible Types

```
error: Argument has incompatible type "X"; expected "Y"  [arg-type]
```

**Fix**: Ensure types match or use proper conversions

### 5. Any from Unfollowed Import

```
error: Type of variable becomes "Any" due to an unfollowed import  [no-any-unimported]
```

**Fix**: Ensure module is importable or add to overrides

## Benefits for AI Coding Agents

This strict configuration forces AI assistants to:

1. **Write complete type hints** on all functions
2. **Use proper generic types** (`list[str]` not `list`)
3. **Avoid `Any` type** except when absolutely necessary
4. **Catch type mismatches** before runtime
5. **Remove redundant code** (like unnecessary casts)
6. **Follow modern Python syntax** (`str | None` not `Optional[str]`)

## Suppressing Errors (Use Sparingly)

When absolutely necessary:

```python
# type: ignore[error-code]  # Explain why this is needed
```

Example:

```python
result = some_qt_function()  # type: ignore[no-untyped-call]  # Qt stub incomplete
```

## Updating Configuration

To modify settings, edit `pyproject.toml` under `[tool.mypy]` section.

## Documentation References

- [MyPy Documentation](https://mypy.readthedocs.io/)
- [MyPy Configuration Options](https://mypy.readthedocs.io/en/stable/config_file.html)
- [MyPy Error Codes](https://mypy.readthedocs.io/en/stable/error_code_list.html)

---

**Last Updated**: February 4, 2026
**Configuration Version**: 1.0 (Maximum Strictness)
